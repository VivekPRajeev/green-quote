# ---- Development ----
FROM node:20-alpine AS dev
WORKDIR /app

# Install base dependencies
RUN apk add --no-cache \
    libc6-compat \
    chromium \
    nss \
    freetype \
    harfbuzz \
    ca-certificates \
    ttf-freefont \
    bash \
    yarn

# Correct path for Alpine Chromium
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# Install dependencies first (cache layer)
COPY package.json package-lock.json* pnpm-lock.yaml* yarn.lock* ./
RUN npm install

# Copy source (but will be overridden by bind mount in docker-compose)
COPY . .

EXPOSE 3000
CMD ["npm", "run", "dev"]
